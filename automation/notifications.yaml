#################################################################
## Automations - Notifications
#################################################################

#################################################################
## Home Assistant Startup Success
#################################################################

- alias: Notification Text - Home Assistant Start

  trigger:
    - platform: homeassistant
      event: start

  action:
    - service: notify.ios_USER1_iphone
      data:
        message: "Home Assistant Started"

        #################################################################
        ## Home Assistant Started Notification
        #################################################################

- alias: Notification Log - Home Assistant Start

  trigger:
    - platform: homeassistant
      event: start
  action:
    service: system_log.write
    data:
      message: "Home Assistant started."

#################################################################
## Water Sensor Automations
#################################################################

        ##########################################################
        ## Send Notification for Water Detected Basement
        ##########################################################

- alias: Water Sensor - Basement Water Sensor Text Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  action:
    - service: notify.hass_sns
      data:
        title: Home Assistant Notification
        message: Water Detected in Basement!
        target: !secret secret_aws_hns_arn

        ##########################################################
        ## Flash Lights when Water Detected
        ##########################################################

- alias: Water Sensor - Flash Lights when Water Detected

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.family
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        brightness_pct: 100
        color_name: "blue"
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        flash: long

#################################################################
## Nest Protect Sensor Automations
#################################################################

        ##########################################################
        ## Flash Lights for Smoke - Warning
        ##########################################################
- alias: Smoke Sensor - Flash Lights when Smoke Warning

  trigger:
    - platform: state
      entity_id: sensor.hallway_nest_protect_smoke_status
      to: 'Warning'
      for:
        hours: 0
        minutes: 0
        seconds: 3
    - platform: state
      entity_id: sensor.kitchen_nest_protect_smoke_status
      to: 'Warning'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  action:
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        brightness_pct: 100
        color_name: "red"
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        flash: long
    - service: notify.hass_sns
      data:
        title: Home Assistant Notification
        message: Smoke - Warning in House!
        target: !secret secret_aws_hns_arn

        ##########################################################
        ## Flash Lights for Smoke - Emergency
        ##########################################################
- alias: Smoke Sensor - Flash Lights when Smoke Emergency

  trigger:
    - platform: state
      entity_id: sensor.hallway_nest_protect_smoke_status
      to: 'Emergency'
      for:
        hours: 0
        minutes: 0
        seconds: 3
    - platform: state
      entity_id: sensor.kitchen_nest_protect_smoke_status
      to: 'Emergency'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  action:
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        brightness_pct: 100
        color_name: "red"
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        flash: long
    - service: notify.hass_sns
      data:
        title: Home Assistant Notification
        message: Smoke - Emergency in House!
        target: !secret secret_aws_hns_arn

        ##########################################################
        ## Flash Lights for CO - Warning
        ##########################################################
- alias: Smoke Sensor - Flash Lights when CO Warning

  trigger:
    - platform: state
      entity_id: sensor.hallway_nest_protect_co_status
      to: 'Warning'
      for:
        hours: 0
        minutes: 0
        seconds: 3
    - platform: state
      entity_id: sensor.kitchen_nest_protect_co_status
      to: 'Warning'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  action:
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        brightness_pct: 100
        color_name: "orange"
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        flash: long
    - service: notify.hass_sns
      data:
        title: Home Assistant Notification
        message: CO - Warning in House!
        target: !secret secret_aws_hns_arn

        ##########################################################
        ## Flash Lights for CO - Emergency
        ##########################################################
- alias: Smoke Sensor - Flash Lights when CO Emergency

  trigger:
    - platform: state
      entity_id: sensor.hallway_nest_protect_co_status
      to: 'Emergency'
      for:
        hours: 0
        minutes: 0
        seconds: 3
    - platform: state
      entity_id: sensor.kitchen_nest_protect_co_status
      to: 'Emergency'
      for:
        hours: 0
        minutes: 0
        seconds: 3

  action:
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        brightness_pct: 100
        color_name: "orange"
    - service: light.turn_on
      entity_id: light.hue_lights
      data:
        flash: long
    - service: notify.hass_sns
      data:
        title: Home Assistant Notification
        message: CO - Emergency in House!
        target: !secret secret_aws_hns_arn

#################################################################
## ETH Miner HashRate Low
#################################################################

- alias: Notification Text - ETH Warning

  trigger:
    - platform: numeric_state
      entity_id: sensor.nanopoolhashrate
      below: 20
      for:
        hours: 0
        minutes: 20
        seconds: 0

  action:
    - service: notify.ios_USER1_iphone
      data:
       message: "Eth hasrate low -- {{states.sensor.nanopoolhashrate.state}}"

#################################################################
## AUX Heat Alert
#################################################################

- alias: Notification Text - AUX Heat

  trigger:
    - platform: state
      entity_id: sensor.thermostat_aux_heat
      from: 'off'
      to: 'on'

  action:
    - service: notify.ios_USER1_iphone
      data:
       message: "Aux Heat turned on"



#################################################################
## NAS Warning
#################################################################

- alias: Notification Text - NAS Warning

  trigger:
    - platform: state
      entity_id: sensor.nas_status
      to: 'warning'

  action:
    - service: notify.ios_USER1_iphone
      data:
        message: "NAS RAID Failing"

#################################################################
## UPS Alerts
#################################################################


        ##########################################################
        ## UPS Power Loss Alert
        ##########################################################

- alias: Notification Text - UPS Power Loss Alert

  trigger:
    - platform: numeric_state
      entity_id: sensor.ups_input_voltage
      below: 80

  action:
    - service: notify.ios_USER1_iphone
      data:
        message: "Power Outage Detected"

        ##########################################################
        ## UPS Low Battery Alert
        ##########################################################

- alias: Notification Text - UPS Low Battery Alert

  trigger:
    - platform: numeric_state
      entity_id: sensor.ups_battery_charge
      below: 15

  action:
    - service: notify.ios_USER1_iphone
      data:
        message: "UPS Battery below 15%"

        ##########################################################
        ## UPS Low Runtime Alert
        ##########################################################

- alias: Notification Text - UPS Low Runtime Alert

  trigger:
    - platform: numeric_state
      entity_id: sensor.ups_battery_runtime_mins
      below: 15

  action:
    - service: notify.ios_USER1_iphone
      data:
        message: "15 mins of UPS Battery Remaining!"
